<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
          integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
          crossorigin="anonymous">

<!-- Main Changes made from the overall protocol 
 1. Commented events from Sentence View 
 2. Commented CandidateList View render function from AppView initialize 
 3. Commented html heading for CandidatelistView at the bottom (where instructions are defined)
 4. 1495 line commented (Removing "Answer:" in Role Spans) 
 5. 1529, 1530 line commented (hide add role button)
 6. Change success and danger buttons to secondary in Role View
 7. Sentence View remove the Source Text button so that it can't be clicked.
 8. Update scroll value in Source Text to whatever the annotators scroll to in all cases
    comment out the if logic "if (activeRoleIsValid)"" completely to update scroll value all the time (line 1457)
 9. added 'roleHeadingDiv' in roleView to display that role info is only for reference.
 10. activeFrameIndex == -2 when the none type option is selected for event type, event trigger function is modified in    EventView and for both EventView and RoleView (if conditions are modified to include both -1 and -2).
 11. Change outputs in the onSubmit function
-->
    
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"
            integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
            crossorigin="anonymous"></script>

    <!-- <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" 
            integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" 
            crossorigin="anonymous"></script> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" 
            integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" 
            crossorigin="anonymous"></script>
    <!-- <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" 
            integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" 
            crossorigin="anonymous"></script> -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
            integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
            crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.9.1/underscore.js"
            integrity="sha384-77p0pqpfMaY9Jg4DcGbencxtYzKWg/Z+wIFbgDlPu4bEwb2fsCrK/ph2uUprTGv8"
            crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/backbone.js/1.4.0/backbone.js"
            integrity="sha384-nhWt56PME93S1JQLa+kxZkVkAPQAVXJ2QFp2upRdyHKS83dOhoiHLwkiWMcLjmPc"
            crossorigin="anonymous"></script>

    <script src="https://s3.amazonaws.com/mturk-public/externalHIT_v1.js"></script>

    <!-- Bootstrap toggle -->            

            <style>
                /**
                 * Bootstrap button colors:
                 *
                 *     btn-primary:   #007bff
                 *     btn-secondary: #5a6268
                 *     btn-success:   #218838
                 *     btn-info:      #16a2b8
                 *     btn-warning:   #f0ad4e
                 *     btn-danger:    #dc3545
                 *     btn-dark:      #23272b
                 *
                 * We use this tool to generate the skeleton for striped buttons:
                 *
                 *     http://stripesgenerator.com
                 */

                 /* Custom button -- https://charliepark.org/bootstrap_buttons */
                .btn-event {
                    background-color: hsl(47, 94%, 48%) !important;
                    background-repeat: repeat-x;
                    filter: progid:DXImageTransform.Microsoft.gradient(startColorstr="#edbb07", endColorstr="#edbb07");
                    background-image: -khtml-gradient(linear, left top, left bottom, from(#edbb07), to(#edbb07));
                    background-image: -moz-linear-gradient(top, #edbb07, #edbb07);
                    background-image: -ms-linear-gradient(top, #edbb07, #edbb07);
                    background-image: -webkit-gradient(linear, left top, left bottom, color-stop(0%, #edbb07), color-stop(100%, #edbb07));
                    background-image: -webkit-linear-gradient(top, #edbb07, #edbb07);
                    background-image: -o-linear-gradient(top, #edbb07, #edbb07);
                    background-image: linear-gradient(#edbb07, #edbb07);
                    border-color: #edbb07 #edbb07 hsl(47, 94%, 48%);
                    color: #fff !important;
                    text-shadow: 0 -1px 0 rgba(0, 0, 0, 0.00);
                    -webkit-font-smoothing: antialiased;
                    }

                .btn-success.btn-dark {
                    background-image: linear-gradient(45deg, #218838 25%, #23272b 25%, #23272b 50%, #218838 50%, #218838 75%, #23272b 75%, #23272b 100%);
                    background-size: 28.28px 28.28px;
                }

                .btn-event.btn-dark {
                    background-image: linear-gradient(45deg, #dc3545 25%, #23272b 25%, #23272b 50%, #dc3545 50%, #dc3545 75%, #23272b 75%, #23272b 100%);
                    background-size: 28.28px 28.28px;
                }

                .btn-outline-success:hover {
                    color: #218838;
                    border-color: #218838;
                    background-color: transparent;
                    background-image: none;
                }
                .btn-outline-success.btn-dark {
                    background-image: linear-gradient(#218838, #23272b, #218838);
                    color: #fff;
                    border-color: #218838;
                    border-left-width: 2px;
                    border-right-width: 2px;
                }
            
                .btn-danger.btn-dark {
                    background-image: linear-gradient(45deg, #dc3545 25%, #23272b 25%, #23272b 50%, #dc3545 50%, #dc3545 75%, #23272b 75%, #23272b 100%);
                    background-size: 28.28px 28.28px;
                }
                .btn-outline-danger:hover {
                    color: #dc3545;
                    border-color: #dc3545;
                    background-color: transparent;
                    background-image: none;
                }
                .btn-outline-danger.btn-dark {
                    background-image: linear-gradient(#dc3545, #23272b, #dc3545);
                    color: #fff;
                    border-color: #dc3545;
                    border-left-width: 2px;
                    border-right-width: 2px;
                }
      
                .token {
                    padding: 0.1rem;
                }

                .announcement{
                color: #FF8800;
                display: inline-block;
                font-weight : bold;
                font-size : 1.2em;
                text-indent: 0;
                margin-bottom: 0;
                padding-bottom: 0;
                }

                /* Override sucess buttons */
                .btn-success {
                    background-color: #0c7bdc !important;
                    border-color: #0c7bdc;
                }
                .btn-outline-success, .btn-outline-success:hover  {
                    background-image: none;
                    color: #0c7bdc;
                    border-color: #0c7bdc;
                    border-left-width: 2px;
                    border-right-width: 2px;
                }

                fex {
                    background-color: #949697;
                    border: 1px solid #949697;
                    color: #fff;
                    margin-right: 5px;
                    padding: 5px; 
                    border-left-width: 2px;
                    border-right-width: 2px;                   
                }

                t {
                    background-color: #949697;
                    border: 1px solid #949697;
                    color: #fff;
                    margin-right: 5px;
                    padding: 5px; 
                    border-left-width: 2px;
                    border-right-width: 2px;                   
                }

                .scrollClass {
                    height:300px;
                    overflow: scroll;
                    }

                hr {
                    position: relative;
                    top: 0px;
                    border: none;
                    height: 1px;
                    background: black;
                    margin-bottom: 5px;
                }

                .example_sentence {
                    text-indent: 2em;
                }
                .example_sentence span {
                    text-indent: 0;
                }
            
                .wrap_btn {
                    white-space: normal;
                }
                
                .noselect {
                -webkit-touch-callout: none; /* iOS Safari */
                    -webkit-user-select: none; /* Safari */
                    -khtml-user-select: none; /* Konqueror HTML */
                    -moz-user-select: none; /* Old versions of Firefox */
                        -ms-user-select: none; /* Internet Explorer/Edge */
                            user-select: none; /* Non-prefixed version, currently
                                                supported by Chrome, Edge, Opera and Firefox */
                }
            </style>

    

<script>
    /* globals Backbone, _, (...?) */
    const notPresentText = 'No candidate found for the current role';
    const notPresentButtonText = 'No candidate found for the current role';
    const notPresentClass = 'btn-outline-primary';
    const activeFrameSpanClass = 'btn-dark';
    const activeRoleSpanClass = 'btn-dark';
    
    const AnswerSpanStatus = {
            OK: 'ok',
            NOT_CANDIDATE: 'not candidate',
            NOT_PRECEDING: 'not preceding',
            NOT_SELECTED: 'not selected'
        };

        //  ****  Span checking functions ******

        // return True if span1 is exactly same as span2 
        function spanEquals(span1, span2) {
            return (span1.sentenceIndex == span2.sentenceIndex &&
                span1.startToken == span2.startToken &&
                span1.endToken == span2.endToken);
        }
    
        // return True if span1 contains span2 
        function spanContains(span1, span2) {
            return (span1.sentenceIndex === span2.sentenceIndex &&
                span1.startToken <= span2.startToken &&
                span1.endToken >= span2.endToken);
        }

        // Check whether the input span contains the input token (token of length 1)
        // inputs: span, sentence_index, token_index
        function spanContainsToken(span, si, ti) {
            return spanContains(span, {sentenceIndex: si, startToken: ti, endToken: ti + 1});
        }
        
        // Check whether span1 is before span2 (can also be in previous sentence)
        function spanPrecedes(span1, span2) {
            return (span1.sentenceIndex < span2.sentenceIndex ||
                (
                    span1.sentenceIndex === span2.sentenceIndex &&
                    span1.endToken <= span2.startToken
                ));
        }
    
        // check whether either span1 or span2 have an overlapping token at the intersection
        //  s1: ......
        //  S2:      ......
        //
        //  OR
        //
        //  s1:      ......
        //  s2: ......
        function spanOverlaps(span1, span2) {
            return (spanContainsToken(span1, span2.sentenceIndex, span2.startToken) ||
                spanContainsToken(span2, span1.sentenceIndex, span1.startToken));
        }
        
        // check whether both span1 and span2 start at the same token
        function spanStartEquals(span1, span2) {
            return (span1.sentenceIndex === span2.sentenceIndex &&
                span1.startToken === span2.startToken);
        }
        
        //check whether both span1 and span2 end at the same token
        function spanEndEquals(span1, span2) {
            return (span1.sentenceIndex === span2.sentenceIndex &&
                span1.endToken === span2.endToken);
        }

    var DataModel = Backbone.Model.extend({
            defaults: {
                activeFrameSpanIndex: 0,
                activeFrameIndex: -1,
                activeRoleIndexSource: 0,
                activeRoleIndexPassage: 0,
                dragStartSentence: -1,
                dragStartToken: -1,
                dragLastSentence: -1,
                dragLastToken: -1,
                unselect: false,
                sourceAnswerSpans: {},
                passageAnswerSpans: {},
                showPassage: true,
                scrollTopValue: 0,
                sourceContainsPassageEvent: -1,
            },
            initialize: function() {
                // fetch the frame highlighted span, we assume there is only one for each document:
                activeFrameSpanIndex = this.attributes.activeFrameSpanIndex
                this.attributes.frameSpan = this.attributes.frameSpans[activeFrameSpanIndex];

                // Initialize the roles for both source and passage for each frames
                this.attributes.rolesPassage = {} ;
                this.attributes.roleDefinitionsPassage = {} ;
                this.attributes.roleExamplesPassage = {} ;

                this.attributes.rolesSource = {} ;
                this.attributes.roleDefinitionsSource = {} ;
                this.attributes.roleExamplesSource = {} ;

                // // Mask all frame names
                // this.maskAllFrameNames();

                for (let i = 0; i < this.attributes.frameNames.length; i++) {
                    var currentFrameName = this.attributes.frameNames[i];
                    // passage roles
                    this.attributes.rolesPassage[currentFrameName] = this.attributes.listCoreRoles[i].slice();
                    this.attributes.roleDefinitionsPassage[currentFrameName] = this.attributes.listRoleDefinitions[i].slice();
                    this.attributes.roleExamplesPassage[currentFrameName] = this.attributes.listRoleExamples[i].slice();
                    // source roles
                    this.attributes.rolesSource[currentFrameName] = this.attributes.listCoreRoles[i].slice();
                    this.attributes.roleDefinitionsSource[currentFrameName] = this.attributes.listRoleDefinitions[i].slice();
                    this.attributes.roleExamplesSource[currentFrameName] = this.attributes.listRoleExamples[i].slice();
                }
                
                // Initialize answer Spans for all frames (both passage and source) 
                for (let i = 0; i < this.attributes.frameNames.length; i++) {
                    var currentFrameName = this.attributes.frameNames[i];
                    var currentFrameRoles = this.attributes.listCoreRoles[i];
                    
                    this.attributes.passageAnswerSpans[currentFrameName] = [];
                    this.attributes.sourceAnswerSpans[currentFrameName] = [];
                    
                    // For each role, add answer spans
                    for (var role of currentFrameRoles) {
                        // passage answerSpan
                        this.attributes.passageAnswerSpans[currentFrameName].push({
                        frameSpan: this.attributes.frameSpan,
                        role: role,
                        notPresent: false,
                        sentenceIndex: -1,
                        startToken: -1,
                        endToken: -1,
                        status: AnswerSpanStatus.OK,
                        scrollTopValue: 0,
                        });

                        // source answerSpan
                        this.attributes.sourceAnswerSpans[currentFrameName].push({
                            frameSpan: {},
                            role: role,
                            notPresent: false,
                            sentenceIndex: -1,
                            startToken: -1,
                            endToken: -1,
                            status: AnswerSpanStatus.OK,
                            scrollTopValue: 0,
                        });  
                    } 
                }

                // initialize certain attributes as per the first frame
                var first_frame_name = this.attributes.frameNames[0];
                this.attributes.activeSourceAnswerSpans = this.attributes.sourceAnswerSpans[first_frame_name];
                this.attributes.activePassageAnswerSpans = this.attributes.passageAnswerSpans[first_frame_name];
                this.attributes.activeCoreRoles = this.attributes.listCoreRoles[0];

                this.attributes.activeRolesPassage = this.attributes.rolesPassage[first_frame_name];
                this.attributes.activeRoleDefinitionsPassage = this.attributes.roleDefinitionsPassage[first_frame_name]
                this.attributes.activeRoleExamplesPassage = this.attributes.roleExamplesPassage[first_frame_name];
                this.attributes.activeRoleIndexPassage = 0

                this.attributes.activeRolesSource = this.attributes.rolesSource[first_frame_name];
                this.attributes.activeRoleDefinitionsSource = this.attributes.roleDefinitionsSource[first_frame_name]
                this.attributes.activeRoleExamplesSource = this.attributes.roleExamplesSource[first_frame_name];
                this.attributes.activeRoleIndexSource = 0
         
                // length of the largest sentence in this document
                var sourceMaxLength = _.max(_.map(this.attributes.sourceSentences, 'length'));
                var passageMaxLength = _.max(_.map(this.attributes.passageSentences, 'length'));

                // Sort source candidate spans
                // first by start token, then by end token
                this.attributes.sourceCandidateSpans = _.sortBy(
                    this.attributes.sourceCandidateSpans,
                    function(span) { return span.sentenceIndex * sourceMaxLength * sourceMaxLength +
                                            span.startToken * sourceMaxLength +
                                            span.endToken; });

                // Sort passage candidate spans
                // first by start token, then by end token
                this.attributes.passageCandidateSpans = _.sortBy(
                    this.attributes.passageCandidateSpans,
                    function(span) { return span.sentenceIndex * passageMaxLength * passageMaxLength +
                                            span.startToken * passageMaxLength +
                                            span.endToken; });

                // Remap all variables to SpanF predicted frame
                // this.remapAllVariablestoSpanfPredictedFrame();
                this.remapAllVariablestoSystemPrediction();

            },


            // mask all frame names as: 'EventType 1', 'EventType 2'
            maskAllFrameNames: function(){
                for (let i = 0; i < this.attributes.frameNames.length; i++) {
                    this.attributes.frameNames[i] = "Event " + (i+1).toString();
            }
            },

            // remap All variables to the SpanF predicted frame using the input data
            remapAllVariablestoSpanfPredictedFrame: function(){
                var spanfPrediction = this.attributes.Spanfinder_frame_prediction;
                for (let i = 0; i < this.attributes.frameNames.length; i++) {
                    if (this.attributes.frameNames[i] == spanfPrediction) {
                        this.remapAllVariables(i);
                    }
                 }  
            },

            // remap All variables to the SpanF predicted frame using the input data
            remapAllVariablestoSystemPrediction: function(){
                var systemPrediction = this.attributes.system_prediction;
                for (let i = 0; i < this.attributes.frameNames.length; i++) {
                    if (this.attributes.frameNames[i] == systemPrediction) {
                        this.remapAllVariables(i);
                    }
                 }  
            },


            // remap all role variables wrt input activeFrameIndex
            remapAllVariables: function(activeFrameIndex) {
                // initialize all frame and role propoerties to current activeFrameIndex
                var activeFrameName = this.attributes.frameNames[activeFrameIndex];
                this.attributes.activeFrameIndex = activeFrameIndex;
                // needed for adding and deleting roles
                this.attributes.activeCoreRoles = this.attributes.listCoreRoles[activeFrameIndex];
                // passage roles
                this.attributes.activeRolesPassage = this.attributes.rolesPassage[activeFrameName];
                this.attributes.activeRoleDefinitionsPassage = this.attributes.roleDefinitionsPassage[activeFrameName]
                this.attributes.activeRoleExamplesPassage = this.attributes.roleExamplesPassage[activeFrameName];
                this.attributes.activeRoleIndexPassage = 0;
                // source roles
                this.attributes.activeRolesSource = this.attributes.rolesSource[activeFrameName];
                this.attributes.activeRoleDefinitionsSource = this.attributes.roleDefinitionsSource[activeFrameName];
                this.attributes.activeRoleExamplesSource = this.attributes.roleExamplesSource[activeFrameName];
                this.attributes.activeRoleIndexSource = 0;

                // map current answer spans
                this.attributes.activeSourceAnswerSpans = this.attributes.sourceAnswerSpans[activeFrameName];
                this.attributes.activePassageAnswerSpans = this.attributes.passageAnswerSpans[activeFrameName];
            },

            // clear values of the input AnswerSpan index
            clearAnswerSpan: function(answerIndex) {
                var showPassage = this.attributes.showPassage;
                if (showPassage) {
                    this.attributes.activePassageAnswerSpans[answerIndex].sentenceIndex = -1;
                    this.attributes.activePassageAnswerSpans[answerIndex].startToken = -1;
                    this.attributes.activePassageAnswerSpans[answerIndex].endToken = -1;
                    this.attributes.activePassageAnswerSpans[answerIndex].scrollTopValue = 0;
                }
                else{
                    this.attributes.activeSourceAnswerSpans[answerIndex].sentenceIndex = -1;
                    this.attributes.activeSourceAnswerSpans[answerIndex].startToken = -1;
                    this.attributes.activeSourceAnswerSpans[answerIndex].endToken = -1;   
                    this.attributes.activeSourceAnswerSpans[answerIndex].scrollTopValue = 0;                 
                }
            },
            
            getSpanText: function(sentences, span, capped=false) {
                if (span.sentenceIndex !== -1) {
                    var s = '';
                    for (var ti = span.startToken; ti < span.endToken; ti++) {
                        s += sentences[span.sentenceIndex][ti] + ' ';
                    }
                    // if capped, get span Text only for first 7 tokens
                    if (capped) {
                        var total_span_length = span.endToken - span.startToken;
                        var s = '';
                        var count_tokens = 0;
                        for (var ti = span.startToken; ti < span.endToken; ti++) {
                            count_tokens += 1
                            s += sentences[span.sentenceIndex][ti] + ' ';
                            if (count_tokens > 7 && count_tokens < total_span_length) {
                                s += "..." ;
                                break;
                            }
                        }
                        
                    }
                    return s;
                } else {
                    return '';
                }
            },

            
            // get the text of frame span
            getFrameSpanText: function(sentences, answerIndex) {
                return this.getSpanText(sentences, this.attributes.frameSpans[answerIndex]);
            },

            getAnswerSpanText: function(answerSpans, answerIndex, capped=false) {
                var showPassage = this.attributes.showPassage;
                if (showPassage) {
                    var sentences = this.attributes.passageSentences;
                }
                else{
                    var sentences = this.attributes.sourceSentences;
                }
               
            return this.getSpanText(sentences, answerSpans[answerIndex], capped=capped);
            },

            isPartOfAnswerSpan: function(answerSpans, answerIndex, si, ti) {
                return spanContainsToken(answerSpans[answerIndex], si, ti);
            },

            // check whether the input token is part of the input answer span
            isPartOfFrameSpan: function(answerIndex, si, ti) {
                return spanContainsToken(this.attributes.frameSpans[answerIndex], si, ti);
            },

            // at the input answerIndex, set the input token (of length 1)
            setTokenAnswerIndex: function(answerIndex, sentenceIndex, tokenIndex) {
                var showPassage = this.attributes.showPassage;

                if (showPassage) {
                    var answerSpan = this.attributes.activePassageAnswerSpans[answerIndex];
                }
                else {
                    var answerSpan = this.attributes.activeSourceAnswerSpans[answerIndex];
                }
                
                // if the answerspan was not present, set the new tokenindex as per input
                if (answerSpan.sentenceIndex === -1) {
                    answerSpan.sentenceIndex = sentenceIndex;
                    answerSpan.startToken = tokenIndex;
                    answerSpan.endToken = tokenIndex + 1;
                    answerSpan.scrollTopValue = this.attributes.scrollTopValue;
                // if the answerspan sentence already present,
                // then put start token as min of (dragStartToken, tokenindex)
                // why is this done?
                // this is updating the highlighted text (if something is already selected)
                } else if (answerSpan.sentenceIndex === sentenceIndex) {
                    answerSpan.startToken = _.min([this.attributes.dragStartToken, tokenIndex]);
                    answerSpan.endToken = _.max([this.attributes.dragStartToken, tokenIndex]) + 1;
                    answerSpan.scrollTopValue = this.attributes.scrollTopValue;
                }
                // why is this initialzed at false for every answer in the first place
                // no candidate flips this attribute
                answerSpan.notPresent = false;
            },
            
            // check if the answerspan is before the frame span
            answerSpanIsPreceding: function(answerSpan) {
                return spanPrecedes(answerSpan, answerSpan.frameSpan);
            },

        
            answerSpanIsCandidate: function(candidateSpans, answerSpan) {
                return _.some(
                    candidateSpans,
                    function(candidateSpan) {
                        return spanEquals(answerSpan, candidateSpan);
                    });
            },

            validateAnswerSpans: function() {

                var sourceAnswerSpans = this.attributes.activeSourceAnswerSpans;
                var sourceCandidateSpans = this.attributes.sourceCandidateSpans;

                var passageAnswerSpans = this.attributes.activePassageAnswerSpans;
                var passageCandidateSpans = this.attributes.passageCandidateSpans;
                
                // Validate Passage Answer Spans
                for (var answerSpan of passageAnswerSpans) {
                    answerSpan.status = AnswerSpanStatus.OK;
                    if (answerSpan.sentenceIndex === -1) {
                        if (!answerSpan.notPresent) {
                            answerSpan.status = AnswerSpanStatus.NOT_SELECTED;
                        }
                    } else {
                        if (! this.answerSpanIsCandidate(passageCandidateSpans, answerSpan)) {
                            
                            answerSpan.status = AnswerSpanStatus.NOT_CANDIDATE;
                            // console.log(answerSpan.status)

                        } 
                    }
                }

                // Validate Source Answer Spans
                for (var answerSpan of sourceAnswerSpans) {
                    answerSpan.status = AnswerSpanStatus.OK;
                    if (answerSpan.sentenceIndex === -1) {
                        if (!answerSpan.notPresent) {
                            answerSpan.status = AnswerSpanStatus.NOT_SELECTED;
                        }
                    } else {
                        if (! this.answerSpanIsCandidate(sourceCandidateSpans, answerSpan)) {
                            
                            answerSpan.status = AnswerSpanStatus.NOT_CANDIDATE;
                            // console.log(answerSpan.status)

                        } 
                    }
                }

                var passage_validate = ! _.some(
                                            passageAnswerSpans,
                                            function(span) { return span.status !== AnswerSpanStatus.OK });

                var source_validate = ! _.some(
                                            sourceAnswerSpans,
                                            function(span) { return span.status !== AnswerSpanStatus.OK });

                            
                // Returns True only when all answerspan's status is OK
                return passage_validate && source_validate
            },

            toggleNotPresent: function(answerIndex) {
                var showPassage = this.attributes.showPassage;
                if (showPassage) {
                    this.attributes.activePassageAnswerSpans[answerIndex].notPresent = !this.attributes.activePassageAnswerSpans[answerIndex].notPresent;
                return this.attributes.activePassageAnswerSpans[answerIndex].notPresent;
                }

                else {
                    this.attributes.activeSourceAnswerSpans[answerIndex].notPresent = !this.attributes.activeSourceAnswerSpans[answerIndex].notPresent;
                return this.attributes.activeSourceAnswerSpans[answerIndex].notPresent;
                }
                
            },

          
            // set the drag attributes to the input values
            setDrag: function(startSentence, startToken, lastSentence, lastToken) {
                this.attributes.dragStartSentence = startSentence;
                this.attributes.dragStartToken = startToken;
                this.attributes.dragLastSentence = lastSentence;
                this.attributes.dragLastToken = lastToken;
            },

            // update the drag ending attributes
            updateDrag: function(lastSentence, lastToken) {
                this.attributes.dragLastSentence = lastSentence;
                this.attributes.dragLastToken = lastToken;
            },


            getRelevantCandidateSpans: function(candidateSpans, answerSpans, answerIndex) {
                var answerSpan = answerSpans[answerIndex];
                return _.filter(candidateSpans, function(candidateSpan) {
                    return (spanOverlaps(candidateSpan, answerSpan));
                });
            },

            // add extra Role as selected from dropdown
            addExtraRole: function(roleName, roleIndex) {
                var showPassage = this.attributes.showPassage;
                if (showPassage) {
                    var roles = this.attributes.activeRolesPassage;
                }
                else {
                    var roles = this.attributes.activeRolesSource;
                }
                // find the current number of present roles with the same name as the input:
                var existingCountRole = 0;
                var finalCount = [];
                for (let i = 0; i < roles.length; i++) {
                    current_role = roles[i];
                    current_role_prefix = current_role.split("__")[0];
                    if (current_role_prefix == roleName) {
                        existingCountRole += 1;
                        finalCount.push(existingCountRole);
                        }
                    }
                
                // get the new index of the role number
                var newCountRole = finalCount.pop();
                
                // add the role to the list of roles
                var newRoleName = roleName+"__"+(newCountRole+1).toString() ;

                if (showPassage) {
                    this.attributes.activeRolesPassage.push(newRoleName);
                    // append copies of definition and example for the extra role
                    var currentRoleDefinition = this.attributes.activeRoleDefinitionsPassage[roleIndex];
                    var currentRoleExample = this.attributes.activeRoleExamplesPassage[roleIndex];
                    this.attributes.activeRoleDefinitionsPassage.push(currentRoleDefinition);
                    this.attributes.activeRoleExamplesPassage.push(currentRoleExample);

                     // add answerSpan for the extra Role
                    this.attributes.activePassageAnswerSpans.push({
                        frameSpan: this.attributes.frameSpans[0],
                        role: newRoleName,
                        notPresent: false,
                        sentenceIndex: -1,
                        startToken: -1,
                        endToken: -1,
                        status: AnswerSpanStatus.OK,
                        scrollTopValue: 0
                    });

                }
                else {
                    this.attributes.activeRolesSource.push(newRoleName);
                    // append copies of definition and example for the extra role
                    var currentRoleDefinition = this.attributes.activeRoleDefinitionsSource[roleIndex];
                    var currentRoleExample = this.attributes.activeRoleExamplesSource[roleIndex];
                    this.attributes.activeRoleDefinitionsSource.push(currentRoleDefinition);
                    this.attributes.activeRoleExamplesSource.push(currentRoleExample);

                     // add answerSpan for the extra Role
                    this.attributes.activeSourceAnswerSpans.push({
                        frameSpan: this.attributes.frameSpans[0],
                        role: newRoleName,
                        notPresent: false,
                        sentenceIndex: -1,
                        startToken: -1,
                        endToken: -1,
                        status: AnswerSpanStatus.OK,
                        scrollTopValue: 0
                    });
                    
                }

               
            },

            // delete extra Role if no candidate is selected
            deleteExtraRole: function(roleIndex) {
                var showPassage = this.attributes.showPassage;
                if (showPassage){
                    var roleName =  this.attributes.activeRolesPassage[roleIndex];
                }
                else{
                    var roleName =  this.attributes.activeRolesSource[roleIndex];
                }

                // If the role is an extra role (i.e. not in CoreRoles)
                if (! this.attributes.activeCoreRoles.includes(roleName)) {
                    if(showPassage) {
                        current_total_roles = this.attributes.activeRolesPassage.length
                        // remove the role from roles, definitions, examples
                        this.attributes.activeRolesPassage = [...this.attributes.activeRolesPassage.slice(0, roleIndex), 
                                                ...this.attributes.activeRolesPassage.slice(roleIndex+1, current_total_roles)]
                        this.attributes.activeRoleDefinitionsPassage = [...this.attributes.activeRoleDefinitionsPassage.slice(0, roleIndex), 
                                                        ...this.attributes.activeRoleDefinitionsPassage.slice(roleIndex+1, current_total_roles)]
                        this.attributes.activeRoleExamplesPassage = [...this.attributes.activeRoleExamplesPassage.slice(0, roleIndex), 
                                                        ...this.attributes.activeRoleExamplesPassage.slice(roleIndex+1, current_total_roles)]
                        // remove the answer span for the extra role
                        this.attributes.activePassageAnswerSpans = [...this.attributes.activePassageAnswerSpans.slice(0, roleIndex), 
                                                        ...this.attributes.activePassageAnswerSpans.slice(roleIndex+1, current_total_roles)]
                    }
                    // ShowSource
                    else {
                        current_total_roles = this.attributes.activeRolesSource.length
                        // remove the role from roles, definitions, examples
                        this.attributes.activeRolesSource = [...this.attributes.activeRolesSource.slice(0, roleIndex), 
                                                ...this.attributes.activeRolesSource.slice(roleIndex+1, current_total_roles)]
                        this.attributes.activeRoleDefinitionsSource = [...this.attributes.activeRoleDefinitionsSource.slice(0, roleIndex), 
                                                        ...this.attributes.activeRoleDefinitionsSource.slice(roleIndex+1, current_total_roles)]
                        this.attributes.activeRoleExamplesSource = [...this.attributes.activeRoleExamplesSource.slice(0, roleIndex), 
                                                        ...this.attributes.activeRoleExamplesSource.slice(roleIndex+1, current_total_roles)]
                        // remove the answer span for the extra role
                        this.attributes.activeSourceAnswerSpans = [...this.attributes.activeSourceAnswerSpans.slice(0, roleIndex), 
                                                        ...this.attributes.activeSourceAnswerSpans.slice(roleIndex+1, current_total_roles)]

                    }

                    this.renameExtraRoles();

                    return true
                }

                else {
                    return false
                }
            },

            // Rename Extra Role names (fix indexes if they are not in order)
            renameExtraRoles: function() {
                // Run a loop over all RoleNames
                // initialize a dict for counting the freq of each role
                var showPassage = this.attributes.showPassage;
                if (showPassage) {
                        var roleIndexes = {};
                        // initialize the counts of all roles to be equal to 1
                        for (let i = 0; i < this.attributes.activeRolesPassage.length; i++) {
                            current_role = this.attributes.activeRolesPassage[i];
                            current_role_prefix = current_role.split("__")[0];
                            roleIndexes[current_role_prefix] = 1
                            }
                        // change role names based on frequency of role
                        for (let i = 0; i < this.attributes.activeRolesPassage.length; i++) {
                            current_role = this.attributes.activeRolesPassage[i];
                            current_role_split_list = current_role.split("__");
                            // re-assign role names for extra roles based on indexes
                            if (current_role_split_list.length != 1){
                                current_role_prefix = current_role_split_list[0]
                                //increment the role index
                                roleIndexes[current_role_prefix] += 1;
                                // fetch the new role index value
                                current_index_count = roleIndexes[current_role_prefix];
                                // concat the prefix with the current index value
                                this.attributes.activeRolesPassage[i] = current_role_prefix.concat("__", current_index_count.toString())
                            }
                        }

                }

                else {
                    var roleIndexes = {};
                        // initialize the counts of all roles to be equal to 1
                        for (let i = 0; i < this.attributes.activeRolesSource.length; i++) {
                            current_role = this.attributes.activeRolesSource[i];
                            current_role_prefix = current_role.split("__")[0];
                            roleIndexes[current_role_prefix] = 1
                            }
                        // change role names based on frequency of role
                        for (let i = 0; i < this.attributes.activeRolesSource.length; i++) {
                            current_role = this.attributes.activeRolesSource[i];
                            current_role_split_list = current_role.split("__");
                            // re-assign role names for extra roles based on indexes
                            if (current_role_split_list.length != 1){
                                current_role_prefix = current_role_split_list[0]
                                //increment the role index
                                roleIndexes[current_role_prefix] += 1;
                                // fetch the new role index value
                                current_index_count = roleIndexes[current_role_prefix];
                                // concat the prefix with the current index value
                                this.attributes.activeRolesSource[i] = current_role_prefix.concat("__", current_index_count.toString())
                            }
                        }

                }
                
            },


            // set the active role index to the input index
            setActiveRoleIndex: function(activeRoleIndex) {
                var showPassage = this.attributes.showPassage;
                if (showPassage) {
                    this.attributes.activeRoleIndexPassage = activeRoleIndex;
                }
                else {
                    this.attributes.activeRoleIndexSource = activeRoleIndex;                    
                }
            },

            // step forward active role index
            stepActiveRoleIndex: function(forward) {
                var showPassage = this.attributes.showPassage;

                if (showPassage) {
                    if (forward) {
                    this.setActiveRoleIndex(
                        (this.attributes.activeRoleIndexPassage + 1) %
                        this.attributes.activePassageAnswerSpans.length);
                    } else {
                        // why this? if forward is not True, what does this mean? cycling back to first index?
                        this.setActiveRoleIndex(
                            this.attributes.activeRoleIndexPassage === 0 ?
                                this.attributes.activePassageAnswerSpans.length - 1 :
                                this.attributes.activeRoleIndexPassage - 1);
                    }
                }
                // Source
                else {
                    if (forward) {
                    this.setActiveRoleIndex(
                        (this.attributes.activeRoleIndexSource + 1) %
                        this.attributes.activeSourceAnswerSpans.length);
                    } else {
                        // why this? if forward is not True, what does this mean? cycling back to first index?
                        this.setActiveRoleIndex(
                            this.attributes.activeRoleIndexSource === 0 ?
                                this.attributes.activeSourceAnswerSpans.length - 1 :
                                this.attributes.activeRoleIndexSource - 1);
                    }
                }
               
            },

            stepSelection: function(forward) {
                var showPassage = this.attributes.showPassage;
                if (showPassage) {
                    var numSentences = this.attributes.passageSentences.length;
                    var sentenceLengths = _.map(this.attributes.passageSentences, 'length');
                    var activeFrameSpan = this.attributes.activePassageAnswerSpans[this.attributes.activeFrameIndex];
                    var activeRoleIndex = this.attributes.activeRoleIndexPassage;
                    var activeRoleSpan = this.attributes.activePassageAnswerSpans[activeRoleIndex];
                }

                else {
                    var numSentences = this.attributes.sourceSentences.length;
                    var sentenceLengths = _.map(this.attributes.sourceSentences, 'length');
                    var activeFrameSpan = this.attributes.activeSourceAnswerSpans[this.attributes.activeFrameIndex];
                    var activeRoleIndex = this.attributes.activeRoleIndexSource;
                    var activeRoleSpan = this.attributes.activeSourceAnswerSpans[activeRoleIndex];
                }
                
                // a list of token spans for each token in each sentences (length = 1)
                var tokenSpans = _.flatten(
                    _.map(
                        _.range(numSentences),
                        function(sentenceIndex) {
                            return _.map(
                                _.range(sentenceLengths[sentenceIndex]),
                                function(tokenIndex) {
                                    return {
                                        sentenceIndex: sentenceIndex,
                                        startToken: tokenIndex,
                                        endToken: tokenIndex + 1
                                    };
                                });
                        }));
                
                // if length of tokenspans > 0
                // move the highlighted text with arow keys 
                if (tokenSpans.length > 0) {
                    var spanBoundaryEquals = spanEndEquals;
                    if (! forward) {
                        spanBoundaryEquals = spanStartEquals;
                        tokenSpans.reverse();
                    }
                    var newTokenSpan = tokenSpans[
                        (activeRoleSpan.sentenceIndex === -1) ?
                            0 :
                            (_.findIndex(
                                tokenSpans,
                                function (tokenSpan) {
                                    return spanBoundaryEquals(activeRoleSpan, tokenSpan);
                                }) + 1) % tokenSpans.length];
                    activeRoleSpan.sentenceIndex = newTokenSpan.sentenceIndex;
                    activeRoleSpan.startToken = newTokenSpan.startToken;
                    activeRoleSpan.endToken = newTokenSpan.endToken;
                }
            },

        });
    

        var CandidateListView = Backbone.View.extend({
            el: '#candidate_list',
            events: {
                'click button.clickable': 'onClick',
                'click button.add_candidate_btn': 'onAddCandidate',
            },

            onAddCandidate: function() { 
                var showPassage = this.model.get('showPassage');

                if (showPassage) {
                    var activeRoleIndex = this.model.attributes.activeRoleIndexPassage;
                    var activeRoleSpan = this.model.attributes.activePassageAnswerSpans[activeRoleIndex];

                    var new_candidate = {'endToken': activeRoleSpan.endToken, 
                                        'sentenceIndex': activeRoleSpan.sentenceIndex, 
                                        'startToken': activeRoleSpan.startToken};

                    // length of the largest sentence in this document
                    var maxLength = _.max(_.map(this.model.attributes.passageSentences, 'length'));
                    // add new candidate to candidate list
                    this.model.attributes.passageCandidateSpans.push(new_candidate);
                    // Sort source candidate spans
                    // first by start token, then by end token
                    this.model.attributes.passageCandidateSpans = _.sortBy(
                        this.model.attributes.passageCandidateSpans,
                        function(span) { return span.sentenceIndex * maxLength * maxLength +
                                                span.startToken * maxLength +
                                                span.endToken; });
                }
                
                else {
                    var activeRoleIndex = this.model.attributes.activeRoleIndexSource;
                    var activeRoleSpan = this.model.attributes.activeSourceAnswerSpans[activeRoleIndex];
                    var new_candidate = {'endToken': activeRoleSpan.endToken, 
                                        'sentenceIndex': activeRoleSpan.sentenceIndex, 
                                        'startToken': activeRoleSpan.startToken};
                    // length of the largest sentence in this document
                    var maxLength = _.max(_.map(this.model.attributes.sourceSentences, 'length'));
                    // add new candidate to candidate list
                    this.model.attributes.sourceCandidateSpans.push(new_candidate);
                    // Sort source candidate spans
                    // first by start token, then by end token
                    this.model.attributes.sourceCandidateSpans = _.sortBy(
                        this.model.attributes.sourceCandidateSpans,
                        function(span) { return span.sentenceIndex * maxLength * maxLength +
                                                span.startToken * maxLength +
                                                span.endToken; });
                }
                this.model.trigger('change');

            },

            // select a given candidate using numeric keys
            selectCandidateByKey: function(key) {
                var keyInt = parseInt(key);
                if (key == 'n') {
                    this.selectCandidate(-1, -1);
                } else if (!isNaN(keyInt) && 0 < keyInt && keyInt < 10) {
                    var button = this.$('button').filter(function() {
                        return $(this).data('index') == keyInt
                    });
                    if (button !== undefined) {
                        var startToken = button.data('start_token');
                        var endToken = button.data('end_token');
                        this.selectCandidate(startToken, endToken);
                    }
                }
            },
            // select a candidate using a given start token and end token
            selectCandidate: function(startToken, endToken) {
                var showPassage = this.model.attributes.showPassage;
                var activeFrameIndex = this.model.attributes.activeFrameIndex;
                if (showPassage) {
                    var activeRoleIndex = this.model.attributes.activeRoleIndexPassage;
                }
                else{
                    var activeRoleIndex = this.model.attributes.activeRoleIndexSource;
                }
                
                // when no candidate is present
                if (startToken === -1 || endToken === -1) {
                    // notPresent toggles to True from the default False value
                    var notPresent = this.model.toggleNotPresent(activeRoleIndex);
                    if (notPresent) {
                        // clear answer spans for the role with no candidate selected
                        this.model.clearAnswerSpan(activeRoleIndex);
                        // delete extra role
                        role_deleted = this.model.deleteExtraRole(activeRoleIndex);
                        if (role_deleted) {
                            // if role was deleted changed the index to previous role
                            if (showPassage)
                            {
                                this.model.attributes.activeRoleIndexPassage = this.model.attributes.activeRoleIndexPassage - 1;
                            }
                            else{
                                this.model.attributes.activeRoleIndexSource = this.model.attributes.activeRoleIndexSource - 1;
                            }
                            
                        }
                    }
                } else {
                    if (showPassage){
                        this.model.attributes.activePassageAnswerSpans[activeRoleIndex].startToken = startToken;
                        this.model.attributes.activePassageAnswerSpans[activeRoleIndex].endToken = endToken;
                    }
                    else{
                        this.model.attributes.activeSourceAnswerSpans[activeRoleIndex].startToken = startToken;
                        this.model.attributes.activeSourceAnswerSpans[activeRoleIndex].endToken = endToken;
                    }
                    
                }
                this.model.trigger('change');
            },

            // 
            onClick: function(event) {
                var startToken = $(event.currentTarget).data('start_token');
                var endToken = $(event.currentTarget).data('end_token');
                this.selectCandidate(startToken, endToken);
            },

            render: function() {
                this.$el.empty();
    
                var activeFrameIndex = this.model.attributes.activeFrameIndex;
                var showPassage = this.model.attributes.showPassage;
                
                
                if (showPassage) {
                    var activeRoleIndex = this.model.attributes.activeRoleIndexPassage;
                    var activeRoleSpan = this.model.attributes.activePassageAnswerSpans[activeRoleIndex];
                    var activeRoleIsValid = (activeRoleSpan.status === AnswerSpanStatus.OK);
                    var candidateSpans = this.model.attributes.passageCandidateSpans;
                    var answerSpans = this.model.attributes.activePassageAnswerSpans;
                    var sentences =  this.model.attributes.passageSentences;
                    this.$el.append($('<h5>').text('Valid Overlapping Candidates in Passage'));
                }

                else {
                    var activeRoleIndex = this.model.attributes.activeRoleIndexSource;
                    var activeRoleSpan = this.model.attributes.activeSourceAnswerSpans[activeRoleIndex];
                    var activeRoleIsValid = (activeRoleSpan.status === AnswerSpanStatus.OK);
                    var candidateSpans = this.model.attributes.sourceCandidateSpans;
                    var answerSpans = this.model.attributes.activeSourceAnswerSpans;
                    var sentences =  this.model.attributes.sourceSentences;
                    this.$el.append($('<h5>').text('Valid Overlapping Candidates in Source'));
                }
                        
                        var index = 1;
                        if (activeRoleSpan.status === AnswerSpanStatus.NOT_SELECTED) {
                            this.$el.append($('<div>')
                                .addClass('alert alert-warning')
                                .text('Select a mention in the text to see the candidates that overlap it.'));
                        } else {
                                var relevantCandidateSpans = this.model.getRelevantCandidateSpans(candidateSpans, answerSpans, activeRoleIndex);
                                
                                if (relevantCandidateSpans.length === 0) {
                                    this.$el.append($('<div>')
                                        .addClass('alert alert-warning')
                                        .text('No overlapping candidates.'));

                                    // Add button for manually adding candidates
                                    if (activeRoleSpan.sentenceIndex != -1 && !activeRoleIsValid) {
                                            this.$el.append($('<button>')
                                            .addClass('btn wrap_btn btn-dark text-left add_candidate_btn')
                                            .addClass(notPresentClass)
                                            .addClass(activeRoleSpan.notPresent ? 'active' : '')
                                            .attr('type', 'button')
                                            .data('start_token', -1)
                                            .data('end_token', -1)
                                            .data('index', -1)
                                            .text("Add currently selected text as a candidate"));
                                        }
                                        
                                } else {
                                    // Add button for manually adding candidates
                                        if (activeRoleSpan.sentenceIndex != -1 && !activeRoleIsValid) {
                                            this.$el.append($('<button>')
                                            .addClass('btn wrap_btn btn-dark text-left add_candidate_btn')
                                            .addClass(notPresentClass)
                                            .addClass(activeRoleSpan.notPresent ? 'active' : '')
                                            .attr('type', 'button')
                                            .data('start_token', -1)
                                            .data('end_token', -1)
                                            .data('index', -1)
                                            .text("Add currently selected text as a candidate"));
                                        }

                                    for (var candidateSpan of relevantCandidateSpans) {
                                        var usableIndex = (0 < index && index < 10);
                                        this.$el.append($('<button>')
                                            .addClass('btn wrap_btn text-left clickable')
                                            .addClass(spanEquals(activeRoleSpan, candidateSpan) ?
                                                'btn-dark' :
                                                'btn-outline-dark')
                                            .attr('type', 'button')
                                            .data('start_token', candidateSpan.startToken)
                                            .data('end_token', candidateSpan.endToken)
                                            .data('index', usableIndex ? index : -1)
                                            .text((usableIndex ? '(' + index + ') ' : '') +
                                                this.model.getSpanText(sentences, candidateSpan)));
                                        ++index;
                                    }
                                }
                        }
                        
                        this.$el.append($('<button>')
                            .addClass('btn wrap_btn text-left clickable answer_not_present_button')
                            .addClass(notPresentClass)
                            .addClass(activeRoleSpan.notPresent ? 'active' : '')
                            .attr('type', 'button')
                            .data('start_token', -1)
                            .data('end_token', -1)
                            .data('index', -1)
                            .text(notPresentButtonText));
                
                
                return this;
            }
        });
    
        var EventView = Backbone.View.extend({
            el: '#event_list',

            events: {
                'click .select_frame_button': 'onSelectFrame',
                'click #source_contains_passage_event_yes': 'onToggleSourceContainsPassageYes',
                'click #source_contains_passage_event_no': 'onToggleSourceContainsPassageNo'
            },

            onSelectFrame: function(event){
                var selectedFrameIndex = $(event.currentTarget).data('frame_index');
                if (selectedFrameIndex == -2){
                    //  initialize all variables
                    // and map FrameIndex to -2
                    this.model.initialize();
                    this.model.attributes.activeFrameIndex = -2;
                    this.model.trigger('change');
                }

                else
                {
                    this.model.remapAllVariables(selectedFrameIndex);
                    this.model.trigger('change');}
            },

            onToggleSourceContainsPassageYes: function(event){
                this.model.attributes.sourceContainsPassageEvent = true
                this.model.trigger('change');

            },

            onToggleSourceContainsPassageNo: function(event){
                this.model.attributes.sourceContainsPassageEvent = false
                this.model.trigger('change');
            },

            render: function(){
                this.$el.empty();
                var activeFrameIndex = this.model.get('activeFrameIndex');
                var activeRoleIndexSource = this.model.get('activeRoleIndexSource');
                var activeRoleIndexPassage = this.model.get('activeRoleIndexPassage');
                var activeFrameSpanIndex = this.model.get('activeFrameSpanIndex');
                
                var activeRoleSpanSource = this.model.attributes.activeSourceAnswerSpans[activeRoleIndexSource];
                var activeRoleIsValidSource = (activeRoleSpanSource.status === AnswerSpanStatus.OK);

                var activeRoleSpanPassage = this.model.attributes.activePassageAnswerSpans[activeRoleIndexPassage];
                var activeRoleIsValidPassage = (activeRoleSpanPassage.status === AnswerSpanStatus.OK);
                
                var activeFrameDefinition = this.model.attributes.frameDefinitions[activeFrameIndex];
                var activeFrameExample = this.model.attributes.frameExamples[activeFrameIndex];
                
                // ***********    Event Navigation Div start **************** //
                var eventSelectDiv = $('<div>')
                            .addClass('clearfix');
                        

                    var framesDiv = $('<div>')
                        .addClass('float-left')
                        .append($('<i>')
                            .addClass('mr-2 mt-1')
                            .text('Select Event Type:'));
                    // Get text of each role
                    for (var frameIndex = 0; frameIndex < this.model.attributes.frameNames.length; frameIndex++) {
                        var frameDiv = $('<div>')
                            .addClass('select_frame_button btn wrap_btn mr-2 mt-1')
                            .addClass(frameIndex === activeFrameIndex ?
                                    'btn-success font-weight-bold' :
                                    'btn-outline-success')
                            .data('frame_index', frameIndex)
                            .text(this.model.attributes.frameNames[frameIndex]);
                        framesDiv.append(frameDiv);
                    }

                    // Add "None" Option in Event Type
                    var frameDiv = $('<div>')
                            .addClass('select_frame_button btn wrap_btn mr-2 mt-1')
                            .addClass(-2 === activeFrameIndex ?
                                    'btn-secondary font-weight-bold' :
                                    'btn-outline-secondary')
                            .data('frame_index', -2)
                            .text('None of the Event Type matches the highlighted span');
                        framesDiv.append(frameDiv);
                    

                        // frame navigation
                    eventSelectDiv.append(framesDiv);
                    this.$el.append(eventSelectDiv);
                // ***********    Event Navigation Div ends **************** //
                
                // ***********    Event Status Div starts **************** //
                var statusDiv = $('<div>')
                    .addClass('clearfix mr-2 mt-1 ');

                // Active Event Text
                if (activeFrameIndex != -1 && activeFrameIndex != -2) {
                    statusDiv.append($('<div>')
                                .addClass('clearfix'));
                        statusDiv.append($('<div>')
                            .addClass('mb-2 float-left')
                            .append($('<i>').addClass('mr-2 mt-1').text('Your Answer for Event Type:'))
                            .append($('<div>')
                            .addClass('btn wrap_btn p-1 mr-4 mt-1 font-weight-bold' + (true ?
                                    ' btn-event' :
                                    ' btn-event'))
                                .text(this.model.attributes.frameNames[activeFrameIndex])));

                        // Event Definition Text
                        statusDiv.append($('<div>')
                                        .addClass('clearfix'));
                        statusDiv.append($('<div>')
                                .addClass('mb-2 float-left')
                                .append($('<i>').addClass('mr-2 mt-1').text('Event Definition:')));
                    
                        statusDiv.append($('<div>')
                                    .addClass('mb-2 float-left')
                                    .text(activeFrameDefinition));  


                        // Event Example Text
                        // Display role example
                        statusDiv.append($('<div>')
                            .addClass('clearfix'));
                            statusDiv.append($('<div>')
                            .addClass('mb-2 float-left')
                            .append($('<i>').addClass('mr-2 mt-1').text('Event Example:')));
                                statusDiv.append(activeFrameExample); 
                }
                // ***********    Event Status Div ends **************** //

                // Add Yes/No button for whether Source contains Passage Event
                // var questionDiv = '<div class="card"><div class="card-body">';
                    var sourceContainsPassageQuestionDiv = '<p style="color:#FF0000"> Does the Source Text contain the exact same event highlighted in the Passage Text?'

                    var sourceContainsPassageEvent = this.model.attributes.sourceContainsPassageEvent;

                    if (sourceContainsPassageEvent == -1) {

                        var sourceContainsPassageEventDiv = '<div class="btn-group btn-group-toggle" data-toggle="buttons"><label for="id1" id="source_contains_passage_event_yes" class="btn btn-outline-dark"><input type="radio" name="options" id="id1" autocomplete="off" checked>Yes</label><label for="id2" id="source_contains_passage_event_no" class="btn btn-outline-dark"><input type="radio" name="options" id="id2" autocomplete="off">No</label></div> </p>'; 
                    }

                    else if (sourceContainsPassageEvent) {
                        var sourceContainsPassageEventDiv = '<div class="btn-group btn-group-toggle" data-toggle="buttons"><label for="id1" id="source_contains_passage_event_yes" class="btn btn-outline-dark active"><input type="radio" name="options" id="id1" autocomplete="off" checked>Yes</label><label for="id2" id="source_contains_passage_event_no" class="btn btn-outline-dark"><input type="radio" name="options" id="id2" autocomplete="off">No</label></div> </p>'; 
                    }
                    
                    else {
                    var sourceContainsPassageEventDiv = '<div class="btn-group btn-group-toggle" data-toggle="buttons"><label for="id1" id="source_contains_passage_event_yes" class="btn btn-outline-dark"><input type="radio" name="options" id="id1" autocomplete="off" checked>Yes</label><label for="id2" id="source_contains_passage_event_no" class="btn btn-outline-dark active"><input type="radio" name="options" id="id2" autocomplete="off">No</label></div> </p>';   
                    }

                    var questionDiv = $('<div>')
                        .addClass('card');

                    questionDiv.append(sourceContainsPassageQuestionDiv);
                    questionDiv.append(sourceContainsPassageEventDiv);

                    this.$el.append(questionDiv);


                this.$el.append(statusDiv);

                return this;
            }
        });


        var SentenceView = Backbone.View.extend({
            el: '#sentence_list',
            events: {
                // 'mousedown .token': 'onStartDrag',
                // 'mouseleave .token': 'onDragLeave',
                // 'mouseenter .token': 'onDrag',
                'click #passage_toggle': 'onTogglePassage',
                'click #source_toggle': 'onToggleSource',
                
            },

            onTogglePassage: function(event) {
                this.model.attributes.showPassage = true
                this.model.trigger('change');
            },

            onToggleSource: function(event) {
                this.model.attributes.showPassage = false
                this.model.trigger('change');
            },

            onStartDrag: function(event) {

                var showPassage = this.model.attributes.showPassage;

                if (showPassage) {
                    var activeRoleIndex = this.model.attributes.activeRoleIndexPassage;
                    var answerSpans = this.model.attributes.activePassageAnswerSpans ;
                    var activeRoleSpan = answerSpans[activeRoleIndex];
                }

                else {
                    var activeRoleIndex = this.model.attributes.activeRoleIndexSource;
                    var answerSpans = this.model.attributes.activeSourceAnswerSpans ;
                    var activeRoleSpan = answerSpans[activeRoleIndex];

                }

                    var si = $(event.currentTarget).data('sentence_index');
                    var ti = $(event.currentTarget).data('token_index');
                    
                    this.model.attributes.unselect = (
                        activeRoleSpan.sentenceIndex == si &&
                        activeRoleSpan.startToken == ti &&
                        activeRoleSpan.endToken == ti + 1
                    );
                    
                    this.model.clearAnswerSpan(activeRoleIndex);
                    this.model.setTokenAnswerIndex(activeRoleIndex, si, ti);
                    this.model.setDrag(si, ti, si, ti);
                    this.model.trigger('change');  
            },

            onDrag: function(event) {

                var showPassage = this.model.attributes.showPassage;

                if (showPassage) {
                    var activeRoleIndex = this.model.attributes.activeRoleIndexPassage;
                    var answerSpans = this.model.attributes.activePassageAnswerSpans ;
                    var activeRoleSpan = answerSpans[activeRoleIndex];
                }

                else {
                    var activeRoleIndex = this.model.attributes.activeRoleIndexSource;
                    var answerSpans = this.model.attributes.activeSourceAnswerSpans ;
                    var activeRoleSpan = answerSpans[activeRoleIndex];

                }

                var si = $(event.currentTarget).data('sentence_index');
                var ti = $(event.currentTarget).data('token_index');
                
                if (si === this.model.attributes.dragStartSentence && (
                        si != this.model.attributes.dragLastSentence ||
                            ti != this.model.attributes.dragLastToken)) {
                    this.model.setTokenAnswerIndex(activeRoleIndex, si, ti);
                    this.model.trigger('change');
                }
                this.model.updateDrag(si, ti);
            },

        
            onDragLeave: function(event) {
                this.model.attributes.unselect = false;
            },


            render: function() {
                this.$el.empty();

                
                
                var showPassage = this.model.attributes.showPassage;
                var frameSpanIndex = 0; // by default we assume only one framespan exists in a doc
                var activeFrameIndex = this.model.get('activeFrameIndex');
                var token_class = "token_button" ;



                if (showPassage) {
                    var sentences = this.model.get('passageSentences');   
                    
                    var activeRoleIndex = this.model.attributes.activeRoleIndexPassage;
                    var answerSpans = this.model.attributes.activePassageAnswerSpans ;
                    var activeRoleSpan = answerSpans[activeRoleIndex];
                    var activeRoleIsValid = (activeRoleSpan.status === AnswerSpanStatus.OK);
                    var headDiv = '<div class="btn-group btn-group-toggle" data-toggle="buttons"><label for="passage_text" id="passage_toggle" class="btn btn-outline-dark active"><input type="radio" name="options" id="passage_text" autocomplete="off" checked> Passage Text</label><label for="source_text" id="source_toggle" class="btn btn-outline-dark"><input type="radio" name="options" id="source_text" autocomplete="off"> Source Text</label></div>' ;                    
                }
                else {
                    var sentences = this.model.get('sourceSentences');
                    var activeRoleIndex = this.model.attributes.activeRoleIndexSource;
                    var answerSpans = this.model.attributes.activeSourceAnswerSpans ;
                    var activeRoleSpan = answerSpans[activeRoleIndex];
                    var activeRoleIsValid = (activeRoleSpan.status === AnswerSpanStatus.OK);
                    var headDiv = '<div class="btn-group btn-group-toggle" data-toggle="buttons"><label for="passage_text" id="passage_toggle" class="btn btn-outline-dark"><input type="radio" name="options" id="passage_text" autocomplete="off" checked> Passage Text</label><label for="source_text" id="source_toggle" class="btn btn-outline-dark active"><input type="radio" name="options" id="source_text" autocomplete="off"> Source Text</label></div>' ;
                }
                  
                // ***********   Text Div starts **************** //
                var textDiv = $('<div>').addClass('mb-3')
                                        .addClass('scrollClass border');

                var activeQueryElement = null;

                var model = this.model;
                // Store scrolltop position of text:
                textDiv.scroll(function() {
                    if (textDiv.html().length) {
                        scroll_t = textDiv.scrollTop();
                        // update model scroll when the mouse is scrolled
                        model.attributes.scrollTopValue = scroll_t
                    }
                    });
                
                var paragraph = $('<p>');
                for (var si = 0; si < sentences.length; si++){
                    for (var ti = 0; ti < sentences[si].length; ti++) {
                        var tokenSpan = $('<span>')
                            .addClass('btn token ' + token_class)
                            .data('sentence_index', si)
                            .data('token_index', ti)
                            .text(sentences[si][ti]);
                        
                        // Highlight the frame event span in passage
                        if (showPassage)
                        {
                            if (this.model.isPartOfFrameSpan(frameSpanIndex, si, ti)) {
                            tokenSpan.addClass('btn-event font-weight-bold');
                            }
                        }
                        
                
                        // // dark token if answerspan is part of current selection
                        if (this.model.isPartOfAnswerSpan(answerSpans, activeRoleIndex, si, ti)) {
                                    tokenSpan.addClass(activeRoleSpanClass);
                                    if (! activeRoleIsValid) {
                                        tokenSpan.addClass('disabled');
                                        // if (activeQueryElement === null) {
                                        //      activeQueryElement = tokenSpan;
                                        //     }
                                    }
                                }

                        paragraph.append(tokenSpan);
                        var whitespaceSpan = $('<span>')
                            .addClass('whitespace noselect')
                            .text(' ');
                        paragraph.append(whitespaceSpan);
                    }
                }
                textDiv.append(paragraph);
                // ***********    Text Div ends **************** //
                this.$el.append(headDiv);
                this.$el.append(textDiv);

                // update the scrollTop value for text Div
                textDiv.scrollTop(model.attributes.scrollTopValue);
                
                // if active role has a valid selected span, then scroll to that span
                // if (activeRoleIsValid) {
                //     textDiv.scrollTop(activeRoleSpan.scrollTopValue);
                // }

                // if (activeQueryElement !== null) {
                //     this.model.attributes.scrollToQuery = false;
                //     activeQueryElement[0].scrollIntoView(true);
                //     }
                
                return this;
            }
        });

        var RoleView =  Backbone.View.extend({
            el: '#role_info',
            events: {
                'click .select_role_button': 'onSelectRole',
                'click button.step_role_button': 'onStepRole',
                'click .dropdown-item': 'onAddRole',
            },

            onStepRole: function(event) {
                var forward = $(event.currentTarget).data('forward');
                this.model.stepActiveRoleIndex(forward);
                this.model.trigger('change');

            },

            onSelectRole: function(event) {
                var roleIndex = $(event.currentTarget).data('role_index');
                this.model.setActiveRoleIndex(roleIndex);
                this.model.trigger('change');
            },

            onAddRole: function(event){
                var selectedRole = $(event.currentTarget).data('rolename');
                var selectedRoleIndex = $(event.currentTarget).data('roleindex');
                this.model.addExtraRole(selectedRole, selectedRoleIndex);
                this.model.trigger('change');
            },

            render: function() {

                this.$el.empty();

                var showPassage = this.model.attributes.showPassage;
                var frameSpanIndex = 0; // by default we assume only one framespan exists in a doc

                if (showPassage) {
                    var sentences = this.model.get('passageSentences');
                    var activeFrameIndex = this.model.get('activeFrameIndex');
                    var activeRoleIndex = this.model.get('activeRoleIndexPassage');
                    var activeRoleSpan = this.model.attributes.activePassageAnswerSpans[activeRoleIndex];
                    var activeRoleIsValid = (activeRoleSpan.status === AnswerSpanStatus.OK);
                    var activeRoleDefinition = this.model.attributes.activeRoleDefinitionsPassage[activeRoleIndex];
                    var activeRoleExample = this.model.attributes.activeRoleExamplesPassage[activeRoleIndex];
                    var roles = this.model.attributes.activeRolesPassage;
                    var activeRole = roles[activeRoleIndex]
                    var answerSpans = this.model.attributes.activePassageAnswerSpans;
                    var activeAnswerSpanText = this.model.getAnswerSpanText(answerSpans, activeRoleIndex, capped=true);
                    
                }

                else {
                    var sentences = this.model.get('sourceSentences');
                    var activeFrameIndex = this.model.get('activeFrameIndex');
                    var activeRoleIndex = this.model.get('activeRoleIndexSource');
                    var activeRoleSpan = this.model.attributes.activeSourceAnswerSpans[activeRoleIndex];
                    var activeRoleIsValid = (activeRoleSpan.status === AnswerSpanStatus.OK);
                    var activeRoleDefinition = this.model.attributes.activeRoleDefinitionsSource[activeRoleIndex];
                    var activeRoleExample = this.model.attributes.activeRoleExamplesSource[activeRoleIndex];
                    var roles = this.model.attributes.activeRolesSource;
                    var activeRole = roles[activeRoleIndex]
                    var answerSpans = this.model.attributes.activeSourceAnswerSpans;
                    var activeAnswerSpanText = this.model.getAnswerSpanText(answerSpans, activeRoleIndex, capped=true);
                    
                }
                
                    // ***********  Active Role Div starts **************** //
                        var roleHeadingDiv = $('<div>')
                                .append($('<h3>').text('Roles for event type "' + this.model.attributes.frameNames[activeFrameIndex] + '" (only for reference)'));
                                    

                        var statusRoleDiv = $('<div>')
                                .addClass('mb-1')
                                .append($('<i>').addClass('me-2 mt-1').text('Active Role: '))
                                .append($('<div>')
                                    .addClass('btn p-1 me-4 mr-4 mt-1 font-weight-bold' + (activeRoleIsValid ?
                                        ' btn-secondary' :
                                        ' btn-secondary'))
                                    .text(activeRole))
                                // .append($('<i>').addClass('mr-2 mt-1').text('Answer: '))
                                // .append($('<div>')
                                //     .addClass('btn p-1 me-4 mt-1' + (activeRoleIsValid ?
                                //         (activeRoleSpan.notPresent ?
                                //             ' btn-primary' :
                                //             ' btn-dark') :
                                //         ' btn-dark disabled'))
                                //     .text(activeRoleIsValid ?
                                //         (activeRoleSpan.notPresent ?
                                //             notPresentText :
                                //             activeAnswerSpanText) :
                                //         activeAnswerSpanText + ' (invalid)'));

                        // ***********    Add Extra role **************** //
                        var addRoleButton = $('<div>');
                        addRoleButton.addClass('mb-2 float-right')
                                    .append($('<button>')
                                        .addClass('btn btn-outline-dark dropdown-toggle add_role_button')
                                        .attr("data-toggle", "dropdown")
                                        .attr("aria-haspopup", "true")
                                        .text('Add Role')
                                        );
                        // add role names 
                        var roledropDowns = $('<div>')
                                            .addClass("dropdown-menu")
                        for (var roleIndex = 0; roleIndex < this.model.attributes.activeCoreRoles.length; roleIndex++) {
                            var roleNameText = $('<a>')
                                            .addClass("dropdown-item")
                                            // .attr("href", "#")
                                            .data("rolename", this.model.attributes.activeCoreRoles[roleIndex])
                                            .data("roleindex", roleIndex)
                                            .text(this.model.attributes.activeCoreRoles[roleIndex])
                                    roledropDowns.append(roleNameText);
                            }
                        // addRoleButton.append(roledropDowns);
                        // statusRoleDiv.append(addRoleButton);
                    // ***********    Active Role Div ends **************** //

                    // ***********    Role Navigation Div start **************** //
                        var navDiv = $('<div>')
                            .addClass('clearfix');
                        
                        var rolesDiv = $('<div>')
                            .addClass('float-left')
                            .append($('<i>')
                                .addClass('mr-2 mt-1')
                                .text('Roles:'));
                        // Get text of each role

                        for (var roleIndex = 0; roleIndex < roles.length; roleIndex++) {
                            var answerSpan = answerSpans[roleIndex];
                            var isValid = (answerSpan.status === AnswerSpanStatus.OK);
                            var roleDiv = $('<div>')
                                .addClass('select_role_button btn wrap_btn mr-2 mt-1')
                                .addClass(isValid ?
                                    (roleIndex === activeRoleIndex ?
                                        'btn-secondary font-weight-bold' :
                                        'btn-outline-secondary') :
                                    (roleIndex === activeRoleIndex ?
                                        'btn-secondary font-weight-bold' :
                                        'btn-outline-secondary'))
                                .data('role_index', roleIndex)
                                .text(roles[roleIndex]);
                            rolesDiv.append(roleDiv);
                        }
                        // role navigation
                        navDiv.append(rolesDiv);
                        navDiv.append($('<div>')
                            .addClass('float-right')
                            .append(
                                $('<button>')
                                    .addClass('btn btn-outline-dark ml-1 mt-1 wrap_btn step_role_button ')
                                    .data('forward', false)
                                    .text('previous role'))
                            .append(
                                $('<button>')
                                    .addClass('btn btn-outline-dark ml-1 mt-1 wrap_btn step_role_button')
                                    .data('forward', true)
                                    .text('next role')));
                        // ***********    Role Navigation Div ends **************** //
                        // ***********    Role Definition/Example Div ends **************** //
                        var roleDefDiv = $('<div>')
                            .addClass('clearfix');
                        roleDefDiv.append($('<div>')
                            .addClass('mb-2 float-left')
                            .append($('<i>').addClass('mr-2 mt-1').text('Role Definition:')));
                        roleDefDiv.append(activeRoleDefinition);

                        // Display role example
                        roleDefDiv.append($('<div>')
                            .addClass('clearfix'));
                        // roleDefDiv.append($('<br>'));
                        roleDefDiv.append($('<div>')
                            .addClass('mb-2 float-left')
                            .append($('<i>').addClass('mr-2 mt-1').text('Role Example:')));
                        roleDefDiv.append(activeRoleExample);
                        // ***********    Role Definition/Example Div ends **************** //

                    if (activeFrameIndex != -1 && activeFrameIndex != -2 ) {
                        this.$el.append(roleHeadingDiv);
                        this.$el.append(statusRoleDiv);
                        this.$el.append(navDiv);
                        this.$el.append(roleDefDiv);
                    }
            }

        });
    

        var AppView = Backbone.View.extend({
            el: '#content',
            events: {
                'mouseup': 'onEndDrag'
            },
            initialize: function() {
                // this.candidateListView = new CandidateListView({model: this.model});
                this.sentenceView = new SentenceView({model: this.model});
                this.eventView = new EventView({model: this.model});
                this.roleView = new RoleView({model: this.model});
              
                // call render view whenever model changes 
                this.listenTo(this.model, 'change', this.render);
            },

            onKey: function(event) {
                var oe = event.originalEvent;
                if (! oe.altKey && ! oe.ctrlKey && ! oe.metaKey) {
                    var shift = oe.shiftKey;
                    var key = oe.key;
                    if (key === 'Tab') {
                        event.preventDefault();
                        // this.model.stepActiveFrameIndex(!shift);
                        this.model.stepActiveRoleIndex(!shift);
                        this.model.trigger('change');
                    } else if (key === '?' || key === 'h') {
                        event.preventDefault();
                        $('#keyboard_shortcuts').modal('toggle');
                    } else if (key === 'i') {
                        event.preventDefault();
                        $('#instructions').collapse('toggle');
                    } else if (key === 'ArrowRight' || key === 'ArrowLeft') {
                        event.preventDefault();
                        this.model.stepSelection(key === 'ArrowRight');
                        this.model.trigger('change');
                    } else if ('123456789n'.split('').includes(key)) {
                        event.preventDefault();
                        this.candidateListView.selectCandidateByKey(key);
                    }
                }
            },
            onSubmit: function(event) {
                
                var activeFrameIndex = this.model.attributes.activeFrameIndex;
                var activeFrameName = this.model.attributes.frameNames[activeFrameIndex];
                var system_prediction = this.model.attributes.system_prediction;
                var spanf_prediction = this.model.attributes.Spanfinder_frame_prediction;
                var bad_candidate = (spanf_prediction != system_prediction);
                var sourceIsSelected = (this.model.attributes.sourceContainsPassageEvent != -1);

                if (this.model.attributes.activeFrameIndex == -1) {
                    this.model.trigger('change');
                    $('#alerts')
                        .attr('class', 'alert alert-danger')
                        .text('Please select an event type first');
                    return false;                    
                }

                else if (sourceIsSelected && (activeFrameName == system_prediction) && bad_candidate){
                    this.model.trigger('change');
                    $('#alerts')
                        .attr('class', 'alert alert-danger')
                        .text('Our system suggests that the selected event type is clearly wrong. Please select the most appropriate one.');
                    return false; 
                }

                else if (this.model.attributes.sourceContainsPassageEvent != -1){
                    var activeFrameIndex = this.model.attributes.activeFrameIndex;
                    var sourceContainsPassageEvent = this.model.attributes.sourceContainsPassageEvent;

                    if (activeFrameIndex == -2) {
                        var activeFrameName = "None Event Type"
                    }
                    else {
                        var activeFrameName = this.model.attributes.frameNames[activeFrameIndex];
                    }
                    
                    var output = {"passageEventType" : activeFrameName,
                                    "sourceContainsPassageEvent": sourceContainsPassageEvent};

                    console.log(JSON.stringify(output));

                    $("#answer_spans").val(JSON.stringify(output));
                    $('#alerts').attr('class', '').text('');
                    return true;
                }
                else {
                    this.model.trigger('change');
                    $('#alerts')
                        .attr('class', 'alert alert-danger')
                        .text('Please select Yes/No for whether the Source Text contains the exact event highlighted in the Passage Text');
                    return false;  
                }
            },
            render: function() {
                $('#alerts').removeClass();
                $('#alerts').empty();
                
                // this.model.validateAnswerSpans();
    
                this.sentenceView.render();
                this.eventView.render();
                this.roleView.render();
                // this.candidateListView.render();
            },
            onEndDrag: function(event) {
                this.model.setDrag(-1, -1, -1, -1);
                var showPassage = this.model.attributes.showPassage;
                if(showPassage) {
                    var activeRoleIndex =  this.model.attributes.activeRoleIndexPassage;
                    var answerSpans = this.model.attributes.activePassageAnswerSpans;
                }
                else {
                    var activeRoleIndex =  this.model.attributes.activeRoleIndexSource;
                    var answerSpans = this.model.attributes.activeSourceAnswerSpans;
                }
                if (this.model.attributes.unselect) {
                    this.model.clearAnswerSpan(activeRoleIndex);
                    this.model.attributes.unselect = false;
                    this.model.trigger('change');
                }
            }
        });

    
    $(document).ready(function() {
            // Fetch data from the dynamic URL which contains the json_data parameter
            var urlParams = new URLSearchParams(window.location.search);
            var jsonData = urlParams.get("json_data");
            var data = JSON.parse(decodeURIComponent(jsonData));
            var dataModel = new DataModel(data);
            var appView = new AppView({model: dataModel});
            appView.render();
            
            $(document).on('keydown', function(e) {return appView.onKey(e)});
            $('#mturk_form').on('submit', function(e) {return appView.onSubmit(e)});
        });


        function toggle_event_type() {
        var ele = document.getElementById("examples_event_type");
        var text = document.getElementById("displaytext_eventtype");
            if (ele.style.display != "none") {
                ele.style.display = "none";
                text.innerHTML = "(show)";
            } else {
                ele.style.display = "block";
                text.innerHTML = "(hide)";
                
            }
        }

        function toggle_role_passage() {
        var ele = document.getElementById("examples_roles_passage");
        var text = document.getElementById("displaytext_roles_passage");
            if (ele.style.display != "none") {
            ele.style.display = "none";
            text.innerHTML = "(show)";
            } else {
            ele.style.display = "block";
            text.innerHTML = "(hide)";
            }
        }

        function toggle_role_source() {
        var ele = document.getElementById("examples_roles_source");
        var text = document.getElementById("displaytext_roles_source");
            if (ele.style.display != "none") {
            ele.style.display = "none";
            text.innerHTML = "(show)";
            } else {
            ele.style.display = "block";
            text.innerHTML = "(hide)";
            }
        }

        function toggle_general_rules() {
        var ele = document.getElementById("examples_general_rules");
        var text = document.getElementById("displaytext_general_rules");
            if (ele.style.display != "none") {
            ele.style.display = "none";
            text.innerHTML = "(show)";
            } else {
            ele.style.display = "block";
            text.innerHTML = "(hide)";
            }
        }

    </script>
    
    <!-- *********************************************** -->
    <!-- HTML -->
    <!-- *********************************************** -->
    <head>
        <script language='Javascript'>
            window.onload = function() {
                turkSetAssignmentID();
            };
        </script>
    </head>
    <!-- This form tag is needed to post the 'hidden' input fields to MTurk -->
    <form id="mturk_form" method="POST">
        <input id="assignmentId" name="assignmentId" type="hidden"></input>
        <input id="answer_spans" name="answer_spans" type="hidden"></input>

    <div id="content" class="container p-4">
        <!-- instructions Start -->
        <div class="text-center">
            <button id="toggle_instructions" class="btn wrap_btn btn-lg btn-info" type="button" data-toggle="collapse" data-target="#instructions" aria-expanded="false" aria-controls="instructions">Instructions</button>
        </div>

        <!-- begin instructions -->
    <div id="instructions" class="ps-5 pe-5 pt-3 pb-3 collapse">
        <p>
            In this task, we give you a <span class="btn token btn-event font-weight-bold">highlighted</span> word or phrase in a <b>Passage Text</b>. The highlighted phrase refers to some kind of situation -- for example, a dynamic event (like running or kicking) or a state of being (like happiness or redness). We then ask you to do the following:
            <ol>
             <li>identify the "event type" of the <span class="btn token btn-event font-weight-bold">highlighted</span> phrase in the <b>Passage Text</b></li> 
             <li>Tell us whether the <b>Source Text</b> contains the description of the same event highlighted in the <b>Passage Text.</b> </li>
            </ol>

            We show an example below to explain both the annotation tasks.
        </p>

        <!-- <span class="announcement">This is a qualification task. We plan to launch a bulk task very soon.</span> -->

             <!-- ###################################### -->
            <!-- 1. Identifying the Event Type -->
             <!-- ###################################### -->
            <h2>1. Identifying the Event Type <a href="javascript:toggle_event_type();" id="displaytext_eventtype" style="font-size: 80%;">(hide)</a></h2>
            
            <div id="examples_event_type">
                <p>
                    Let us look at the task through an example. We have highlighted one word that refers to a situation (or <em>event</em>) in the <b>Passage Text</b> as shown below: 
                </p>

                <div class="card card-body">
                    <div class="btn-group btn-group-toggle" data-toggle="buttons"><label for="passage_text" id="passage_toggle_example" class="btn btn-outline-dark active"><input type="radio" name="options" id="passage_text" autocomplete="off" checked=""> Passage Text</label></div>
                    <br>
                    <div class="example_sentence">
                        He was <span class="btn token btn-event font-weight-bold">hired</span> as a Research Scientist by Microsoft.
                    </div>
                </div>

                <p>
                    Your task is to identify what type of event is highlighted in the Passage Text from a list of 5 options, as shown below:
                </p>
                <!-- Blank buttons -->
                <div>
                    <div class="select_frame_button btn wrap_btn mr-2 mt-1 btn-outline-success">Choosing</div><div class="select_frame_button_example btn wrap_btn mr-2 mt-1 btn-outline-success">Firing</div>
                    <div class="select_frame_button_example btn wrap_btn mr-2 mt-1 btn-outline-success">Renting</div>
                    <div class="select_frame_button_example btn wrap_btn mr-2 mt-1 btn-outline-success">Hiring</div><div class="select_frame_button_example btn wrap_btn mr-2 mt-1 btn-outline-success">Appointing</div>
                </div>

            
                <p> Clicking on an event type button displays the definition of that event type along with an example of that event type:</p>

                <div class="card card-body">
                        <!-- Highlighted event buttons -->
                    <div>
                        <div class="select_frame_button_example btn wrap_btn mr-2 mt-1 btn-outline-success">Choosing</div><div class="select_frame_button_example btn wrap_btn mr-2 mt-1 btn-outline-success">Firing</div>
                        <div class="select_frame_button_example btn wrap_btn mr-2 mt-1 btn-outline-success">Renting</div>
                        <div class="select_frame_button_example btn wrap_btn mr-2 mt-1 btn-success font-weight-bold">Hiring</div>
                        <div class="select_frame_button_example btn wrap_btn mr-2 mt-1 btn-outline-success">Appointing</div>
                    </div>

                    <!-- Event definition and example -->
                    <div class="clearfix mr-2 mt-1"><div class="clearfix"></div><div class="mb-2 float-left"><i class="mr-2 mt-1">Your Answer for Event Type:</i><div class="btn wrap_btn p-1 mr-4 mt-1 font-weight-bold btn-event">Hiring</div></div><div class="clearfix"></div><div class="mb-2 float-left"><i class="mr-2 mt-1">Event Definition:</i></div><div class="mb-2 float-left">An Employer hires an Employee, promising the Employee a certain Compensation in exchange for the performance of a job.</div><div class="clearfix"></div><div class="mb-2 float-left"><i class="mr-2 mt-1">Event Example:</i></div>John was <t>hired</t> to clean up the file system.</div>
                </div>
                <p> For our running example, <b>Hiring</b> is the correct event type.</p>

            <p>Most of the times, you should find the correct event type among the given options, although sometimes it can happen that none of the event types fit well for the <span class="btn token btn-event font-weight-bold">highlighted</span> phrase. If you feel that none of the displayed Event Types match the highlighted span, you can click on the following button:

             <div class="select_frame_button_example btn wrap_btn mr-2 mt-1 btn-secondary font-weight-bold">None of the Event Type matches the highlighted span</div>
              
            </p>
            <!-- ###################################### -->
            <!-- 1.1. Roles in Pasage Text -->
             <!-- ###################################### -->
            <h4>1.1. Roles (or Participants) in Passage Text <a href="javascript:toggle_role_passage();" id="displaytext_roles_passage" style="font-size: 80%;">(hide)</a></h4>
            <div id="examples_roles_passage">
                <p>
                    We provide the roles of each event type along with its definition. Roles are different participants of the event. We provide the roles to give you a better idea of the event type in case it is not clear from the event definition. When clicking on an event type, its roles are also displayed below the passage text. These are only meant for reference. For example, the "Hiring" event type has 5 fixed roles as shown in the below example. The current active role is "Employee": 
                </p>

                <div class="card card-body">
                    <div class="btn-group btn-group-toggle" data-toggle="buttons"><label for="passage_text" id="passage_toggle_example" class="btn btn-outline-dark active"><input type="radio" name="options" id="passage_text" autocomplete="off" checked=""> Passage Text</label></div>
                    <!-- Passage Text -->
                    <div id="sentence_list_example"><div class="btn-group btn-group-toggle" data-toggle="buttons">
                    </div><div class="mb-3 border"><p><span class="btn token token_button">He</span><span class="whitespace noselect"> </span><span class="btn token token_button">was</span><span class="whitespace noselect"> </span><span class="btn token token_button btn-event font-weight-bold">hired</span><span class="whitespace noselect"> </span><span class="btn token token_button">as</span><span class="whitespace noselect"> </span><span class="btn token token_button">a</span><span class="whitespace noselect"> </span><span class="btn token token_button">Research</span><span class="whitespace noselect"> </span><span class="btn token token_button">Scientist</span><span class="whitespace noselect"> </span><span class="btn token token_button">by</span><span class="whitespace noselect"> </span><span class="btn token token_button">Microsoft</span><span class="whitespace noselect"> </span><span class="btn token token_button">.</span><span class="whitespace noselect"> </span></p></div></div>
                    <!-- Active Role and Answer -->
                    <div id="role_info_example">
                        <div class="mb-1">
                            <i class="me-2 mt-1">Active Role: </i>
                            <div class="btn p-1 me-4 mr-4 mt-1 font-weight-bold btn-secondary">Employee</div>
                        </div>
                    </div>
                    <!-- Display roles -->
                    <div class="clearfix">
                        <div class="float-left"><i class="mr-2 mt-1">Roles:</i>
                            <div class=" btn wrap_btn mr-2 mt-1 btn-secondary font-weight-bold">Employee</div>
                            <div class=" btn wrap_btn mr-2 mt-1 btn-outline-secondary">Employer</div>
                            <div class=" btn wrap_btn mr-2 mt-1 btn-outline-secondary">Task</div>
                            <div class=" btn wrap_btn mr-2 mt-1 btn-outline-secondary">Position</div>
                            <div class=" btn wrap_btn mr-2 mt-1 btn-outline-secondary">Field</div>
                        </div>
                        <div class="float-right">
                            <div class=" btn wrap_btn mr-2 mt-1 btn-outline-dark">previous role</div>
                            <div class=" btn wrap_btn mr-2 mt-1 btn-outline-dark">next role</div>
                        </div>
                    </div>
                    <!-- Role Definition and Example -->
                    <div class="clearfix">
                        <div class="mb-2 float-left">
                            <i class="mr-2 mt-1">Role Definition:</i>
                        </div>
                        The person whom the <fen>Employer</fen> takes on as an <fen>Employee</fen>, obligating them to perform some <fen>Task</fen> in order to receive <fen>Compensation</fen>.
                        <div class="clearfix"></div>
                        <div class="mb-2 float-left">
                            <i class="mr-2 mt-1">Role Example:</i>
                        </div>
                        <fex name="Employee">I</fex> was just hired yesterday!
                    </div>
                </div>
                <p>
                    You can click on buttons for different roles to see its definition and example. Each role has a fixed definition and a fixed example. The definition and example of the active role is displayed below the list of all roles.

                </p>
                <!-- 2.1 Role Annotation Examples -->
                <!-- 2.1.1: Annotated Role: Employee -->
                <p> You can click on the "next role" Button to activate the next role or alternatively just click on any of the Roles to activate that role for annotation.</p>
                <!-- Annotated Role: Position -->
                <p> Below is the definition and example for the role "Position":</p>
                <div class="card card-body">
                    <div class="btn-group btn-group-toggle" data-toggle="buttons"><label for="passage_text" id="passage_toggle_example" class="btn btn-outline-dark active"><input type="radio" name="options" id="passage_text" autocomplete="off" checked=""> Passage Text</label></div>
                    <!-- Passage Text -->
                    <div id="sentence_list_example"><div class="btn-group btn-group-toggle" data-toggle="buttons">
                    </div><div class="mb-3 border"><p><span class="btn token token_button">He</span><span class="whitespace noselect"> </span><span class="btn token token_button">was</span><span class="whitespace noselect"> </span><span class="btn token token_button btn-event font-weight-bold">hired</span><span class="whitespace noselect"> </span><span class="btn token token_button">as</span><span class="whitespace noselect"> </span><span class="btn token token_button">a</span><span class="whitespace noselect"> </span><span class="btn token token_button">Research</span><span class="whitespace noselect"> </span><span class="btn token token_button">Scientist</span><span class="whitespace noselect"> </span><span class="btn token token_button">by</span><span class="whitespace noselect"> </span><span class="btn token token_button">Microsoft</span><span class="whitespace noselect"> </span><span class="btn token token_button">.</span><span class="whitespace noselect"> </span></p></div></div>
                    <!-- Active Role and Answer -->
                    <div id="role_info_example">
                        <div class="mb-1">
                            <i class="me-2 mt-1">Active Role: </i>
                            <div class="btn p-1 me-4 mr-4 mt-1 font-weight-bold btn-secondary">Position</div>
                    
                        <div class="mb-2 float-right"></div>
                    </div>
                    <!-- Display roles -->
                    <div class="clearfix"><div class="float-left"><i class="mr-2 mt-1">Roles:</i><div class="select_role_button btn wrap_btn mr-2 mt-1 btn-outline-secondary">Employee</div><div class="select_role_button btn wrap_btn mr-2 mt-1 btn-outline-secondary">Employer</div><div class="select_role_button btn wrap_btn mr-2 mt-1 btn-outline-secondary">Task</div><div class="select_role_button btn wrap_btn mr-2 mt-1 btn-secondary font-weight-bold">Position</div><div class="select_role_button btn wrap_btn mr-2 mt-1 btn-outline-secondary">Field</div></div>
                    <div class="float-right">
                        <div class=" btn wrap_btn mr-2 mt-1 btn-outline-dark">previous role</div>
                        <div class=" btn wrap_btn mr-2 mt-1 btn-outline-dark">next role</div>
                    </div>
                    </div>
                    <div class="clearfix">
                        <div class="mb-2 float-left"><i class="mr-2 mt-1">Role Definition:</i>
                        </div>The label given to a particular type of employment.
                        <div class="clearfix"></div>
                        <div class="mb-2 float-left"><i class="mr-2 mt-1">Role Example:</i></div>Look, I wasn't hired <fex name="Posit">as your waitress</fex>!</div></div>
                </div>

                <p>Roles are only provided to help you understand the definition of an event type better in case it is not clear from the event definition and the event example itself. Feel free to ignore the roles if the event type makes sense to you just by reading the event definition and event example.</p>
            
                </div>
                
            </div>

            <!-- ###################################### -->
            <!-- 3. Does the Source Text contain the highlighted event? -->
             <!-- ###################################### -->
             <h2>2. Does the Source Text contain the highlighted event? <a href="javascript:toggle_role_source();" id="displaytext_roles_source" style="font-size: 80%;">(hide)</a></h2>

             <div id="examples_roles_source">
                <p> The <b>Passage Text</b> is obtained from a source that we call the <b>Source Text</b>. Ideally, the Source Text should contain the situation highlighted in the Passage Text, but sometimes we have errors in source extraction which might lead the situation in Passage Text to not be present in the Source Text. To identify this, we want you to check whether the Source Text contains the event that is highlighted in the Passage Text. </p>

                <p> Let us look at the Source Text of our running example to verify this. </p>
                <div class="card card-body">
                <div class="row pt-3 pb-3">
                    <div class="col-9">
                        <div id="sentence_list_example"><div class="btn-group btn-group-toggle" data-toggle="buttons"><label for="passage_text" id="passage_toggle" class="btn btn-outline-dark"><input type="radio" name="options" id="passage_text" autocomplete="off" checked=""> Passage Text</label><label for="source_text" id="source_toggle" class="btn btn-outline-dark active"><input type="radio" name="options" id="source_text" autocomplete="off"> Source Text</label></div><div class="mb-3 border"><p><span class="btn token token_button">John</span><span class="whitespace noselect"> </span><span class="btn token token_button">Smith</span><span class="whitespace noselect"> </span><span class="btn token token_button">is</span><span class="whitespace noselect"> </span><span class="btn token token_button">a</span><span class="whitespace noselect"> </span><span class="btn token token_button">recent</span><span class="whitespace noselect"> </span><span class="btn token token_button">graduate</span><span class="whitespace noselect"> </span><span class="btn token token_button">of</span><span class="whitespace noselect"> </span><span class="btn token token_button">the</span><span class="whitespace noselect"> </span><span class="btn token token_button">University</span><span class="whitespace noselect"> </span><span class="btn token token_button">of</span><span class="whitespace noselect"> </span><span class="btn token token_button">Washington</span><span class="whitespace noselect"> </span><span class="btn token token_button">.</span><span class="whitespace noselect"> </span><span class="btn token token_button">He</span><span class="whitespace noselect"> </span><span class="btn token token_button">interned</span><span class="whitespace noselect"> </span><span class="btn token token_button">at</span><span class="whitespace noselect"> </span><span class="btn token token_button">Microsoft</span><span class="whitespace noselect"> </span><span class="btn token token_button">Research</span><span class="whitespace noselect"> </span><span class="btn token token_button">in</span><span class="whitespace noselect"> </span><span class="btn token token_button">Seattle</span><span class="whitespace noselect"> </span><span class="btn token token_button">,</span><span class="whitespace noselect"> </span><span class="btn token token_button">Washington</span><span class="whitespace noselect"> </span><span class="btn token token_button">.</span><span class="whitespace noselect"> </span><span class="btn token token_button">His</span><span class="whitespace noselect"> </span><span class="btn token token_button">research</span><span class="whitespace noselect"> </span><span class="btn token token_button">interests</span><span class="whitespace noselect"> </span><span class="btn token token_button">include</span><span class="whitespace noselect"> </span><span class="btn token token_button">machine</span><span class="whitespace noselect"> </span><span class="btn token token_button">learning</span><span class="whitespace noselect"> </span><span class="btn token token_button">,</span><span class="whitespace noselect"> </span><span class="btn token token_button">computer</span><span class="whitespace noselect"> </span><span class="btn token token_button">vision</span><span class="whitespace noselect"> </span><span class="btn token token_button">,</span><span class="whitespace noselect"> </span><span class="btn token token_button">and</span><span class="whitespace noselect"> </span><span class="btn token token_button">natural</span><span class="whitespace noselect"> </span><span class="btn token token_button">language</span><span class="whitespace noselect"> </span><span class="btn token token_button">processing</span><span class="whitespace noselect"> </span><span class="btn token token_button">.</span><span class="whitespace noselect"> </span><span class="btn token token_button">After</span><span class="whitespace noselect"> </span><span class="btn token token_button">6</span><span class="whitespace noselect"> </span><span class="btn token token_button">rounds</span><span class="whitespace noselect"> </span><span class="btn token token_button">of</span><span class="whitespace noselect"> </span><span class="btn token token_button">interviewing</span><span class="whitespace noselect"> </span><span class="btn token token_button">,</span><span class="whitespace noselect"> </span><span class="btn token token_button">he</span><span class="whitespace noselect"> </span><span class="btn token token_button">was</span><span class="whitespace noselect"> </span><span class="btn token token_button">employed</span><span class="whitespace noselect"> </span><span class="btn token token_button">as</span><span class="whitespace noselect"> </span><span class="btn token token_button">a</span><span class="whitespace noselect"> </span><span class="btn token token_button">Research</span><span class="whitespace noselect"> </span><span class="btn token token_button">Scientist</span><span class="whitespace noselect"> </span><span class="btn token token_button">by</span><span class="whitespace noselect"> </span><span class="btn token token_button">Microsoft</span><span class="whitespace noselect"> </span><span class="btn token token_button">to</span><span class="whitespace noselect"> </span><span class="btn token token_button">work</span><span class="whitespace noselect"> </span><span class="btn token token_button">on</span><span class="whitespace noselect"> </span><span class="btn token token_button">their</span><span class="whitespace noselect"> </span><span class="btn token token_button">new</span><span class="whitespace noselect"> </span><span class="btn token token_button">chatbot</span><span class="whitespace noselect"> </span><span class="btn token token_button">.</span><span class="whitespace noselect"> </span></p></div></div>
                        
            
                    </div>
        
                </div>
                </div>

                <p>The last sentence of the source text above mentions the hiring event (<i>he was employed</i>) that was highlighted in the Passage Text. So for this example, we would select "Yes" for the question:</p>

                <div class="card">
                    <p style="color:#FF0000"> Does the Source Text contain the exact same event highlighted in the Passage Text?
                        <div class="btn-group btn-group-toggle" data-toggle="buttons"><label for="source_contains_passage_event_yes_" id="source_contains_passage_event_yes_example" class="btn btn-outline-dark active"><input type="radio" name="options" id="passage_text" autocomplete="off" checked>Yes</label><label for="source_contains_passage_event_no_" id="source_contains_passage_event_no_example" class="btn btn-outline-dark"><input type="radio" name="options" id="source_text" autocomplete="off">No</label></div> 
                       </p>
                </div>

                <p>Note that even though a different word (<i>employed</i>) is used to describe the same event in the passage (<i>hired</i>), we still selected "Yes" since the event described is the same event.</p>
                
                <p> On the other hand, if the source Text were something like the below: </p>
                <div class="card card-body">
                    <div class="row pt-3 pb-3">
                        <div class="col-9">
                            <div id="sentence_list_example"><div class="btn-group btn-group-toggle" data-toggle="buttons"><label for="passage_text" id="passage_toggle" class="btn btn-outline-dark"><input type="radio" name="options" id="passage_text" autocomplete="off" checked=""> Passage Text</label><label for="source_text" id="source_toggle" class="btn btn-outline-dark active"><input type="radio" name="options" id="source_text" autocomplete="off"> Source Text</label></div><div class="mb-3 border"><p><span class="btn token token_button">John</span><span class="whitespace noselect"> </span><span class="btn token token_button">Smith</span><span class="whitespace noselect"> </span><span class="btn token token_button">is</span><span class="whitespace noselect"> </span><span class="btn token token_button">a</span><span class="whitespace noselect"> </span><span class="btn token token_button">recent</span><span class="whitespace noselect"> </span><span class="btn token token_button">graduate</span><span class="whitespace noselect"> </span><span class="btn token token_button">of</span><span class="whitespace noselect"> </span><span class="btn token token_button">the</span><span class="whitespace noselect"> </span><span class="btn token token_button">University</span><span class="whitespace noselect"> </span><span class="btn token token_button">of</span><span class="whitespace noselect"> </span><span class="btn token token_button">Washington</span><span class="whitespace noselect"> </span><span class="btn token token_button">.</span><span class="whitespace noselect"> </span><span class="btn token token_button">He</span><span class="whitespace noselect"> </span><span class="btn token token_button">interned</span><span class="whitespace noselect"> </span><span class="btn token token_button">at</span><span class="whitespace noselect"> </span><span class="btn token token_button">Microsoft</span><span class="whitespace noselect"> </span><span class="btn token token_button">Research</span><span class="whitespace noselect"> </span><span class="btn token token_button">in</span><span class="whitespace noselect"> </span><span class="btn token token_button">Seattle</span><span class="whitespace noselect"> </span><span class="btn token token_button">,</span><span class="whitespace noselect"> </span><span class="btn token token_button">Washington</span><span class="whitespace noselect"> </span><span class="btn token token_button">.</span><span class="whitespace noselect"> </span><span class="btn token token_button">His</span><span class="whitespace noselect"> </span><span class="btn token token_button">research</span><span class="whitespace noselect"> </span><span class="btn token token_button">interests</span><span class="whitespace noselect"> </span><span class="btn token token_button">include</span><span class="whitespace noselect"> </span><span class="btn token token_button">machine</span><span class="whitespace noselect"> </span><span class="btn token token_button">learning</span><span class="whitespace noselect"> </span><span class="btn token token_button">,</span><span class="whitespace noselect"> </span><span class="btn token token_button">computer</span><span class="whitespace noselect"> </span><span class="btn token token_button">vision</span><span class="whitespace noselect"> </span><span class="btn token token_button">,</span><span class="whitespace noselect"> </span><span class="btn token token_button">and</span><span class="whitespace noselect"> </span><span class="btn token token_button">natural</span><span class="whitespace noselect"> </span><span class="btn token token_button">language</span><span class="whitespace noselect"> </span><span class="btn token token_button">processing</span><span class="whitespace noselect"> </span><span class="btn token token_button">.</span><span class="whitespace noselect"> </span><span class="btn token token_button">Last</span><span class="whitespace noselect"> </span><span class="btn token token_button">year</span><span class="whitespace noselect"> </span><span class="btn token token_button">,</span><span class="whitespace noselect"> </span><span class="btn token token_button">John's</span><span class="whitespace noselect"> </span><span class="btn token token_button">sister</span><span class="whitespace noselect"> </span><span class="btn token token_button">,</span><span class="whitespace noselect"> </span><span class="btn token 
                            token_button">Mary</span><span class="whitespace noselect"> </span><span class="btn token 
                            token_button">,</span><span class="whitespace noselect"> </span><span class="btn token token_button">was</span><span class="whitespace noselect"> </span><span class="btn token token_button">hired</span><span class="whitespace noselect"> </span><span class="btn token token_button">as</span><span class="whitespace noselect"> </span><span class="btn token token_button">a</span><span class="whitespace noselect"> </span><span class="btn token token_button">Research</span><span class="whitespace noselect"> </span><span class="btn token token_button">Scientist</span><span class="whitespace noselect"> </span><span class="btn token token_button">by</span><span class="whitespace noselect"> </span><span class="btn token token_button">Google</span><span class="whitespace noselect"> </span><span class="btn token token_button">.</span><span class="whitespace noselect"> </span></p></div></div>
                        </div>
                    </div>
                    </div>

                    <p>Even though there is a mention of a hiring event in the last sentence of the source text above, it is not the same event that is described in the passage text (Check the Passage Text in Section 1). The passage text mentions the event of hiring John, whereas the source above mentions the event of hiring John's sister. So for this source text, we would select "No" for the question:</p>

                    <div class="card">
                        <p style="color:#FF0000"> Does the Source Text contain the exact same event highlighted in the Passage Text?
                            <div class="btn-group btn-group-toggle" data-toggle="buttons"><label for="source_contains_passage_event_yes_" id="source_contains_passage_event_yes" class="btn btn-outline-dark"><input type="radio" name="options" id="passage_text" autocomplete="off" checked>Yes</label><label for="source_contains_passage_event_no_" id="source_contains_passage_event_no" class="btn btn-outline-dark active"><input type="radio" name="options" id="source_text" autocomplete="off">No</label></div> 
                           </p>
                    </div>

            </div>
             
            <!-- End of instructions button -->
            <div class="text-center">
                <button id="toggle_instructions" class="btn wrap_btn btn-lg btn-info" type="button" data-toggle="collapse" data-target="#instructions" aria-expanded="false" aria-controls="instructions">Collapse Instructions</button>
            </div>

    </div>
    
    
    <!-- End of instructions -->

        <!-- begin main interface -->
    <div class="row pt-3 pb-3">
        <div class="col-9">
            <div id="event_list"></div>
            <div id="sentence_list"></div>
            <div id="role_info" ></div>

        </div>

        <!-- <div class="col-3">
            <div class=" border p-3 sticky-top">
                <div id="candidate_list" class="btn-group-vertical"></div>
            </div>
        </div> -->
    </div>
    <!-- end main interface -->

        <div id="alerts"></div>

        <!-- Keyboard shortcuts -->
        <div class="modal fade" id="keyboard_shortcuts" tabindex="-1" role="dialog" aria-labelledby="keyboard_shortcuts_title" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="keyboard_shortcuts_title">Keyboard Shortcuts</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <table class="table">
                            <tr>
                                <td><span class="btn btn-light p-1 border">Tab</span></td>
                                <td>Go to the next role </td>
                            </tr>
                            <tr>
                                <td><span class="btn btn-light p-1 border mr-2">Shift</span><span class="btn btn-light p-1 border">Tab</span></td>
                                <td>Go to the previous role</td>
                            </tr>
                            
                            <tr>
                                <td><span class="btn btn-light p-1 border">i</span></td>
                                <td>Show/hide instructions</td>
                            </tr>
                            <tr>
                                <td><span class="btn btn-light p-1 border">?</span></td>
                                <td>Show/hide keyboard shortcuts</td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>
     <div class="text-center"><input id="submitButton" class="btn btn-outline-primary" type="submit" value="Submit" /></div>

    
    </form>